<html>
<%- include ("partes/cabecera2") %>
<script>
    function entregar(form){
        let res = confirm('¿Estas seguro que deseas marcar como entregada esta ficha?');
        if (res){
            let accion = $(this).attr("action");
            alert(accion);
            $.ajax({
      beforeSend: function () {
        
        $("p#boton").html("Guardando...");
      },
      url: "/bibliotecario/actualizar",
      type: "POST",
      data: data,
      processData: false,
      contentType: false,
    })
      .done(function (res) {
        $("div#estatus").html(
          `<img src="/assets/icons/correcto.ico"width= "20" height= "20">`
        );
        $("div#mensaje").html(`<p class="text-center">${res.mensaje}</p>`);
        $("p#boton").html("Se ha actualizado");
        let titulo = `div#${res.libro.cota}_titulo`;
        let tipo = `div#${res.libro.cota}_tipo`;
        actualizarFormato(titulo, tipo, res.libro);
        
       
        $("div#myModal")
        .modal("hide")
        .on('hidden.bs.modal', function (e) {
          $("div#myModal2").modal("show");
          $(this).off('hidden.bs.modal');
        });

      })
      .fail(function (error) {
        $("div#estatus").html(
          `<img src="/assets/icons/notificacion-error.ico"width= "20" height= "20">`
        );
        $("p#boton").html("¡Ha fallado!");
      });
  
   
        }
    }
</script>
<body>
    <%- include ("partes/navegacionB") %>
    <div class="content-page-container full-reset custom-scroll-containers">
       <%- include ("partes/navegacionSuperiorB") %>
        <div class="container">
            <div class="page-header">
              <h1 class="all-tittles">Sistema bibliotecario <small>préstamos y reservaciones</small></h1>
            </div>
        </div>
        <div class="conteiner-fluid">
            <ul class="nav nav-tabs nav-justified"  style="font-size: 17px;">
                <li class="active"><a href="/bibliotecario/prestamos">Préstamos entregados</a></li>
                <li><a href="/bibliotecario/prestamos-vig-ven"  >Préstamos pendientes</a></li>
                <li><a href="loanreservation.html">Reservaciones</a></li>
            </ul>
        </div>
        <div class="container-fluid"  style="margin: 50px 0;">
            <div class="row">
                <div class="col-xs-12 col-sm-4 col-md-3">
                    <img src="/assets/img/calendar_book.png" alt="calendar" class="img-responsive center-box" style="max-width: 110px;">
                </div>
                <div class="col-xs-12 col-sm-8 col-md-8 text-justify lead">
                    Bienvenido a esta sección, aquí se muestran todos los préstamos de libros realizados hasta la fecha y que ya se entregaron satisfactoriamente
                </div>
            </div>
        </div>
        <% if ( fichas.length>0) { %>
        <div class="container-fluid">
            <h2 class="text-center all-tittles">Listado de préstamos</h2>
            <div class="table-responsive">
                <div class="div-table" style="margin:0 !important;">
                    <div class="div-table-row div-table-row-list" style="background-color:#DFF0D8; font-weight:bold;">
                        <div class="div-table-cell" style="width: 6%;">#</div>
                        <div class="div-table-cell" style="width: 22%;">Cota</div>
                        <div class="div-table-cell" style="width: 22%;">Correo</div>
                        
                        <div class="div-table-cell" style="width: 10%;">F. Solicitud</div>
                        <div class="div-table-cell" style="width: 10%;">F. Entrega</div>
                        <div class="div-table-cell" style="width: 8%;">Entregar</div>
                        <div class="div-table-cell" style="width: 8%;">Ver Ficha</div>
                    </div>
                </div>
            </div>
            <% for ( var i=0; i < fichas.length; i++) { %>
               
                <div class="table-responsive">
                    <div class="div-table" style="margin:0 !important;">
                        <div class="div-table-row div-table-row-list">
                            <div class="div-table-cell" style="width: 6%;"><%= 1+i %></div>
                            <div class="div-table-cell" style="width: 22%;"><%= fichas[i].cota_f %></div>
                            <div class="div-table-cell" style="width: 22%;"><%= fichas[i].correo_f %></div>
                            <div class="div-table-cell" style="width: 10%;"><%= fichas[i].fecha_e %></div>
                            <div class="div-table-cell" style="width: 10%;"><%= fichas[i].fecha_d %></div>
                            <div class="div-table-cell" style="width: 8%;">
                                <form method="POST" action='/cards/eliminar?cota=<%= fichas[i].cota_f%>&_method=DELETE' onsubmit="entregar(this)">
                                <button id="entregar" class="btn btn-success"><i class="zmdi zmdi-time-restore"></i></button>
                            </form>
                            </div>
                            <div class="div-table-cell" style="width: 8%;">
                                <button class="btn btn-info" ><i class="zmdi zmdi-file-text"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
                <% } %>
             <% } else {%>
                <div class="container-fluid">
                    <h3 class="text-center all-tittles">No hay préstamos entregados </h3>
                </div>
                <% } %>
        <%- include ("partes/piePagina") %>   
    </div>
</body>
</html>